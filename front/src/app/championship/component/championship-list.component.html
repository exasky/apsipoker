<div class="d-flex flex-column flex-shrink-0">
  <button mat-raised-button
          class="flex-shrink-0 m-3"
          (click)="create()">
    <div class="d-flex align-items-center">
      <mat-icon class="mr-2">add</mat-icon>
      Créer
    </div>
  </button>
  <div class="flex-grow overflow d-flex flex-column">
    <button mat-raised-button color="accent"
            *ngFor="let championship of championships"
            class="flex-shrink-0 m-3"
            (click)="select(championship)">
      {{championship.name}}
    </button>
  </div>
</div>


<mat-card class="m-3 flex-grow d-flex flex-column" *ngIf="selectedChampionship">
  <mat-card-header class="flex-shrink-0 d-flex align-items-start flex-wrap">
    <mat-card-title>
      <div *ngIf="selectedChampionship.name">{{selectedChampionship.name}}</div>
      <div *ngIf="!selectedChampionship.name">Nouveau</div>
    </mat-card-title>
    <div class="flex-grow d-flex justify-content-end" *ngIf="!isEdit">
      <button mat-raised-button (click)="edit()">
        <mat-icon>edit</mat-icon>
        Editer
      </button>
      <button mat-raised-button color="warn" class="mx-2" *ngIf="selectedChampionship.id" (click)="delete()">
        <mat-icon>delete</mat-icon>
        Supprimer
      </button>
    </div>
    <div class="flex-grow d-flex justify-content-end" *ngIf="isEdit">
      <button mat-raised-button (click)="cancel()">
        <mat-icon>undo</mat-icon>
        Annuler
      </button>
      <button mat-raised-button color="accent" class="mx-2" (click)="save()">
        <mat-icon>save</mat-icon>
        Sauver
      </button>
    </div>
  </mat-card-header>

  <mat-card-content class="d-flex flex-column overflow">
    <div class="d-flex justify-content-evenly">
      <mat-form-field appearance="fill">
        <mat-label>Nom du championnat</mat-label>
        <input matInput [(ngModel)]="championshipEdit.name"
               required
               autocomplete="nope"
               [disabled]="!isEdit">
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Date de début</mat-label>
        <input matInput [matDatepicker]="startPicker" [(ngModel)]="championshipEdit.startDate" [disabled]="!isEdit">
        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Date de fin</mat-label>
        <input matInput [matDatepicker]="endPicker" [(ngModel)]="championshipEdit.endDate" [disabled]="!isEdit">
        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </mat-form-field>
    </div>

    <h3>Gestion des participants</h3>

    <div class="d-flex justify-content-evenly">
      <div class="flex-1 mx-2 d-flex flex-column">
        <h5>Tous les utilisateurs</h5>

        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Filtrer</mat-label>
          <input matInput [(ngModel)]="userFilter"/>
        </mat-form-field>

        <mat-list cdkDropList
                  class="list"
                  #userList="cdkDropList"
                  [cdkDropListData]="users"
                  [cdkDropListConnectedTo]="[selectedUserList]"
                  (cdkDropListDropped)="drop($event)">
          <mat-list-item *ngFor="let user of users | filter:userFilter:'username'"
                         class="list-item"
                         cdkDrag>
            <div class="flex-grow d-flex justify-content-between">
              {{user.username}}
              <mat-icon (click)="addUserToChampionship(user)">keyboard_arrow_right</mat-icon>
            </div>
          </mat-list-item>
        </mat-list>
      </div>

      <div class="flex-1 mx-2 d-flex flex-column">
        <h5>Participants</h5>

        <mat-list cdkDropList
                  class="list"
                  #selectedUserList="cdkDropList"
                  [cdkDropListData]="selectedUsers"
                  [cdkDropListConnectedTo]="[userList]"
                  (cdkDropListDropped)="drop($event)">
          <mat-list-item *ngFor="let user of selectedUsers"
                         class="list-item"
                         cdkDrag>
            <div class="flex-grow d-flex">
              <mat-icon (click)="removeUserFromChampionship(user)">keyboard_arrow_left</mat-icon>
              {{user.username}}
            </div>
          </mat-list-item>
        </mat-list>
      </div>
    </div>
    TODO list of tournaments

  </mat-card-content>
</mat-card>
